---
title: "Analysis Tables"
output: 
  pdf_document:
    toc: yes
    fig_caption: yes
  html_document:
    code_folding: hide
---

```{r setup, results='hide', warning=FALSE, message=FALSE, echo=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)
# set wd as rproj folder
setwd("../")
# import functions
options(box.path = getwd())
box::use(dplyr[...],
         ggplot2[...],
         lme4[lmer],
         texreg[screenreg, htmlreg, texreg, knitreg],
         plm[plm],
         sandwich[vcovCL, vcovHC],
         lmtest[coeftest],
         lubridate[date],
         magrittr[use_series, extract],
         readr[read_csv],
         # import own project functions
         functions/ts[...])

load_project_data()

my_theme <- theme_minimal() +
  theme(legend.position = "top",
        axis.line.x = element_line(), axis.ticks.x = element_line(),
        plot.caption = element_text(hjust = 0),
        plot.tag.position = "topright", plot.tag = element_text(face = "bold"))

theme_set(my_theme)

```

```{r summary}
data %>% 
  select(distrust_people, log_gdp, gdp_growth, education_index, log_conflict, conf_govt, polity2,
         pop.km2, pop_65, ghs, gini_disp) %>% 
  distinct() %>% 
  gtsummary::tbl_summary(
    type = gtsummary::all_continuous() ~ "continuous2",
    statistic = list(gtsummary::all_continuous() ~ c("{mean} ({sd})")),
    missing_text = "Missing Data",
    label = list(distrust_people ~ "Distrust in People",
                 log_gdp ~ "Log of GDP per Capita",
                 gdp_growth ~ "GDP Growth",
                 log_conflict ~ "Log of Conflict Index",
                 education_index ~ "Education Index", 
                 conf_govt ~ "Confidence in Government", 
                 polity2 ~ "Polity",
                 pop.km2 ~ "Population Density (per km2)", 
                 pop_65 ~ "Population over age 65", 
                 ghs ~ "Global Health Security Index",
                 gini_disp ~ "Gini Coefficient")
  ) %>%
  gtsummary::modify_header(list(label ~ "**Variable**")) %>%
  gtsummary::italicize_labels() %>%
  gtsummary::add_stat_label(label = list(gtsummary::all_continuous() ~ c("Mean (SD)"))) %>%
  # gtsummary::as_tibble() %>% 
  # knitr::kable(caption = "Summary Statistics")
  gtsummary::as_gt() %>%
  gt::tab_source_note(source_note = "SD = Standard Deviation")
```


```{r main_analysis, results='asis', echo=TRUE}

## Initial models
# pooled regression clustered SE on location
pooled1 <- data %>% 
  lm(formula = stringency_index ~ distrust_people) %>% 
  coeftest(., vcovCL, cluster = ~location)

# simple random effects model
model1 <- data %>% 
  lmer(stringency_index ~ distrust_people + (1 | location), .)


# adding economic indicators
model2 <- data %>% 
  lmer(stringency_index ~ distrust_people + log_gdp + gdp_growth + education_index + 
         (1 | location), .)

# adding population over 65 and population density
model3 <- data %>% 
  lmer(stringency_index ~ distrust_people + log_gdp + gdp_growth + education_index +
         pop_65 + (1 | location), .)


# adding ghs
model4 <- data %>% 
  lmer(stringency_index ~ distrust_people + log_gdp + gdp_growth + education_index +
         pop_65 + ghs + (1 | location), .) 


# add polity
model5 <- data %>% 
  lmer(stringency_index ~ distrust_people + log_gdp + gdp_growth + education_index +
         pop_65 + ghs + polity2 + (1 | location), .) 


# include conflict
model6 <- data %>% 
  lmer(stringency_index ~ distrust_people + log_gdp + gdp_growth + education_index +
         pop_65 + ghs + polity2 + log_conflict + (1 | location), .) 

model7 <- data %>% 
  lmer(stringency_index ~ distrust_people + log_gdp + gdp_growth + education_index +
         pop_65 + ghs + polity2 + log_conflict + pop.km2 + (1 | location), .) 

model8 <- data %>% 
  lmer(stringency_index ~ distrust_people + log_gdp + gdp_growth + education_index +
         pop_65 + ghs + polity2 + log_conflict + pop.km2 + conf_govt + (1 | location), .) 

model9 <- data %>% 
  lmer(stringency_index ~ distrust_people + log_gdp + gdp_growth + education_index +
         pop_65 + ghs + polity2 + log_conflict + pop.km2 + conf_govt + gini_disp + (1 | location), .) 

knitreg(list(pooled1, model1, model2, model3, model4, model5, model6, model7, model8, model9), omit.coef = "Intercept", 
        include.aic = FALSE, include.bic = FALSE, include.loglik = FALSE)

```


```{r additional_analysis, results='asis', echo=TRUE}
model10 <- data %>% 
  lmer(stringency_index ~ distrust_people + log_gdp + gdp_growth + education_index +
         pop_65 + ghs + polity2 + log_conflict + pop.km2 + conf_govt + 
         deaths_per_mil_lag_1 + (1 | location), .) 
model11 <- data %>% 
  lmer(stringency_index ~ distrust_people + log_gdp + gdp_growth + education_index +
         pop_65 + ghs + polity2 + log_conflict + pop.km2 + conf_govt + 
         trans_chng_lag_15 + (1 | location), .)
model12 <- data %>% 
  lmer(stringency_index ~ distrust_people + log_gdp + gdp_growth + education_index +
         pop_65 + ghs + polity2 + log_conflict + pop.km2 + conf_govt + 
         deaths_per_mil_lag_1 + trans_chng_lag_15 + (1 | location), .)

model13 <- data %>% 
  lmer(stringency_index ~ distrust_people + log_gdp + gdp_growth + education_index +
         pop_65 + ghs + polity2 + log_conflict + pop.km2 + conf_govt + 
         deaths_per_mil_lag_1 + trans_chng_lag_15 + stringency_index_lag_1 + (1 | location), .)


htmlreg(list(model8, model10, model11, model12, model13), omit.coef = "Intercept", 
        custom.model.names = c("Model 9", "Model 11", "Model 12", "Model 13", "Model 14"), 
        include.aic = FALSE, include.bic = FALSE, include.loglik = FALSE)
```

```{r other_policy, results='asis', echo=TRUE}
model_response <- data %>% 
  lmer(response_index ~ distrust_people + log_gdp + gdp_growth + education_index +
         pop_65 + ghs + polity2 + log_conflict + pop.km2 + conf_govt + (1 | location), .)
model_containment <- data %>% 
  lmer(containment_index ~ distrust_people + log_gdp + gdp_growth + education_index +
         pop_65 + ghs + polity2 + log_conflict + pop.km2 + conf_govt + (1 | location), .)
model_support <- data %>% 
  lmer(support_index ~ distrust_people + log_gdp + gdp_growth + education_index +
         pop_65 + ghs + polity2 + log_conflict + pop.km2 + conf_govt + (1 | location), .)
# lm_support <- data %>% 
#   lm(support_index ~ distrust_people + log_gdp + gdp_growth + education_index +
#          pop_65 + ghs + polity2 + log_conflict + pop.km2 + conf_govt, .) %>% 
#   coeftest(., vcovCL, cluster = ~location)
#   


htmlreg(list(model8, model_containment, model_support, model_response), omit.coef = "^((?!distrust).)*$",
        custom.model.names = c("Stringency", "Containment", "Support", "Response"), 
        include.aic = FALSE, include.bic = FALSE, include.loglik = FALSE)

```






