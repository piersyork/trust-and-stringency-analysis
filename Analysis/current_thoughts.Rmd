---
title: "current_thoughts/questions"
output: 
  html_document:
    code_folding: hide
---

```{r setup, results='hide', warning=FALSE, message=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
# set wd as rproj folder
setwd("../")
# import functions
options(box.path = getwd())
box::use(dplyr[...],
         ggplot2[...],
         lme4[lmer],
         texreg[screenreg, htmlreg],
         plm[plm],
         sandwich[vcovCL, vcovHC],
         lmtest[coeftest],
         lubridate[date],
         magrittr[use_series, extract],
         readr[read_csv],
         # import own project functions
         functions/ts[...])

load_project_data()

my_theme <- theme_minimal() +
  theme(legend.position = "top",
        axis.line.x = element_line(), axis.ticks.x = element_line(),
        plot.caption = element_text(hjust = 0),
        plot.tag.position = "topright", plot.tag = element_text(face = "bold"))

theme_set(my_theme)

```

Model 4 includes all covariates\
Model 5 adds a lagged variable for stringency\
Model 6 removes res_pct_chng\
Model 7 takes the log of conflict index\
Model 7.5 is the same as Model 7 but excludes Nicaragua (is it an outlier?)\
Model 8 same as model 7 but includes res_chng\
Model 9 includes a variable for total deaths so far. In theory this accounts for the previous effects of the pandemic

```{r significance, results='asis'}
# adding other country fixed variables
model4 <- data %>% 
  lmer(stringency_index ~ distrust_people + deaths_per_mil_lag_5 + res_chng_lag_34 +
         conflict_index + continent + conf_govt +
         log(gdp_per_capita) + ghs + pop.km2 + democracy_index + ethnic + education_index +
         (1 | location), .)

# add lagged stringency to right hand side of formula
model5 <- data %>% 
  lmer(stringency_index ~ distrust_people + continent + res_chng_lag_34 +
         deaths_per_mil_lag_5 + conflict_index + conf_govt +
         log(gdp_per_capita) + ghs + pop.km2 + democracy_index + ethnic + education_index +
         stringency_index_lag_1 +
         (1 | location), .)

# no res chng
model6 <- data %>% 
  lmer(stringency_index ~ distrust_people + continent + deaths_per_mil_lag_5 + 
         conflict_index + conf_govt +
         log(gdp_per_capita) + ghs + pop.km2 + democracy_index + ethnic + education_index +
         (1 | location), .)

# including almost all variables and playing around with logged vars. Exclude Nicaragua because outlier?
model7 <- data %>% 
  # filter(!location == "Nicaragua") %>%
  lmer(stringency_index ~ distrust_people + deaths_per_mil_lag_5 + conf_govt + 
         log(conflict_index) + continent +
         log(gdp_per_capita) + ghs + pop.km2 + democracy_index + ethnic + education_index +
         (1 | location), .)

model7_5 <- data %>% 
  filter(!location == "Nicaragua") %>%
  lmer(stringency_index ~ distrust_people + deaths_per_mil_lag_5 + conf_govt + 
         log(conflict_index) + continent +
         log(gdp_per_capita) + ghs + pop.km2 + democracy_index + ethnic + education_index +
         (1 | location), .)

# model 7 but including res_chng
model8 <- data %>% 
  lmer(stringency_index ~ distrust_people + deaths_per_mil_lag_5 + res_chng_lag_34 +
         conf_govt + 
         log(conflict_index) + continent +
         log(gdp_per_capita) + ghs + pop.km2 + democracy_index + ethnic + education_index +
         (1 | location), .)

# include total deaths
model9 <- data %>% 
  filter(!location == "Nicaragua") %>%
  lmer(stringency_index ~ distrust_people + conf_govt + total_deaths_per_million +
         log(conflict_index) + continent + deaths_per_mil_lag_5 +
         log(gdp_per_capita) + ghs + pop.km2 + democracy_index + ethnic + education_index +
         (1 | location), .)



htmlreg(list(model4, model5, model6, model7, model7_5, model8, model9), omit.coef = "Intercept", custom.model.names = c("Model 4", "Model 5", "Model 6", "Model 7", "Model 7.5", "Model 8", "Model 9"))

```


```{r time_plots, results='hide'}
# model 4
m4_time <- data %>% 
  get_coefs(stringency_index ~ distrust_people + deaths_per_mil_lag_5 + res_chng_lag_34 +
         conflict_index + continent + conf_govt +
         log(gdp_per_capita) + ghs + pop.km2 + democracy_index + ethnic + education_index,
         method = "lm", print_plot = FALSE, n_days = 1)

m4_time$plot + 
  labs(tag = "Model 4")

# model 6
m6_time <- data %>% 
  get_coefs(stringency_index ~ distrust_people + continent + deaths_per_mil_lag_5 + 
         conflict_index + conf_govt +
         log(gdp_per_capita) + ghs + pop.km2 + democracy_index + ethnic + education_index,
         method = "lm", print_plot = FALSE, n_days = 1)

m6_time$plot + 
  labs(tag = "Model 6")

# model 7, including Nicaragua
m7_time <- data %>% 
  get_coefs(stringency_index ~ distrust_people + deaths_per_mil_lag_5 + conf_govt + 
         log(conflict_index) + continent +
         log(gdp_per_capita) + ghs + pop.km2 + democracy_index + ethnic + education_index,
         method = "lm", print_plot = FALSE, n_days = 1)

m7_time$plot + 
  labs(tag = "Model 7")

# model 8
m8_time <- data %>% 
  get_coefs(stringency_index ~ distrust_people + conf_govt + total_deaths_per_million +
         conflict_index + continent + deaths_per_mil_lag_5 +
         log(gdp_per_capita) + ghs + pop.km2 + democracy_index + ethnic + education_index,
         method = "lm", print_plot = FALSE, n_days = 1)

m8_time$plot +
  labs(tag = "Model 8")

```

Should I include use logged conflict instead of raw conflict
```{r logged_conflict}

data %>% plot_summarised(conflict_index, stringency_index) +
  labs(title = "Relationship between raw conflict and stringency index")
data %>% 
  mutate(log_conflict = log(conflict_index)) %>% 
  plot_summarised(log_conflict, stringency_index) +
  labs(title = "Relationship between logged conflict and stringency index")

data %>% plot_summarised(conflict_index, distrust_people) +
  labs(title = "Relationship between raw conflict and distrust")
data %>% 
  mutate(log_conflict = log(conflict_index)) %>% 
  plot_summarised(log_conflict, distrust_people) +
  labs(title = "Relationship between logged conflict and distrust")

min(data$conflict_index, na.rm = TRUE)
```






